function getURLParameter(n){return decodeURI((RegExp(n+"=(.+?)(&|$)").exec(location.search)||[,null])[1])}$(function(){function v(){if(!this.files){i.submit();return}if(this.files.length!=0){var n=this.files[0],r=n.name.split(".").pop().toLowerCase();if($.inArray(r,s)===-1){t.fail({title:"Unsupported image format",description:"(Supported formats: "+s.join(", ")+")"});return}if(n.size>o*1048576){t.fail({title:"File is too large",description:"(Max file size: "+o+"MB)"});return}y(n)}}function y(n){i.disable();t.loading();var r=new FormData;r.append("file",n);$.ajax({url:e,type:"POST",data:r,cache:!1,dataType:"json",processData:!1,contentType:!1}).done(function(n){h(n)}).fail(function(){t.fail(u);i.enable()})}function p(){$("#logoForm").attr("action",e);$("#logoFrame").on("readystatechange",function(){if(this.readyState=="complete")try{var n=this.contentDocument.body.innerHTML;h(n)}catch(r){t.fail(u);i.enable()}})}function h(r){try{if(!r)throw"Response is empty";if(typeof r!="object"&&(r=JSON.parse(r)),!r||!r.success||!r.data)throw"Request is not success";n.logo.url(r.data.url);t.default()}catch(f){t.fail(u)}finally{i.enable()}}ko.bindingHandlers.fadeVisible={init:function(n,t){var i=t();$(n).toggle(ko.unwrap(i))},update:function(n,t){var i=t();ko.unwrap(i)?$(n).fadeIn():$(n).fadeOut()}};var c=getURLParameter("courseId"),l=getURLParameter("templateId"),r=location.protocol+"//"+location.host,f=r+"/api/course/"+c+"/template/"+l,a=1,n={isSaved:ko.observable(!1),isFailed:ko.observable(!1),logo:function(){var n={};return n.url=ko.observable("").extend({throttle:300}),n.hasLogo=ko.computed(function(){return n.url()!=""}),n.clear=function(){n.url("")},n.isError=ko.observable(!1),n.errorText=ko.observable(""),n.errorDescription=ko.observable(""),n.isLoading=ko.observable(!1),n}(),hasStarterPlan:ko.observable(!0)};n.saveChanges=function(){var t={logo:{url:n.hasStarterPlan()?n.logo.url():""}};n.isFailed(!1);n.isSaved(!1);$.post(f,{settings:JSON.stringify(t)}).done(function(){n.isSaved(!0)}).fail(function(){n.isFailed(!0)})};$.ajax({cache:!1,url:f,dataType:"json",success:function(t){var i;try{i=JSON.parse(t)}catch(r){i={logo:{}}}n.logo.url(i.logo.url||"")}});$.ajax({url:r+"/api/identify",type:"POST",contentType:"application/json",dataType:"json",success:function(t){if(t.hasOwnProperty("subscription")&&t.subscription.hasOwnProperty("accessType")){var i=t.subscription.accessType>=a&&new Date(t.subscription.expirationDate)>=new Date;n.hasStarterPlan(i)}else n.hasStarterPlan(!1)},error:function(){n.hasStarterPlan(!1)}});ko.applyBindings(n,$("#settingsForm")[0]);var e=r+"/storage/image/upload",o=10,s=["jpeg","jpg","png","bmp","gif"],u={title:"Something went wrong",description:"Please, try again"},t={"default":function(){n.logo.isLoading(!1);n.logo.isError(!1)},fail:function(t){n.logo.clear();n.logo.isLoading(!1);n.logo.errorText(t.title);n.logo.errorDescription(t.description);n.logo.isError(!0)},loading:function(){n.logo.isLoading(!0)}},i={enable:function(){this.$input.attr("disabled",!1).closest(".image-upload-button").removeClass("disabled")},disable:function(){this.$input.attr("disabled",!0).closest(".image-upload-button").addClass("disabled")},submit:function(){this.$input[0].form.submit();this.disable();t.loading()},$input:function(){return $("#logoInput").on("change",v)}()};window.top.navigator.userAgent.match(/MSIE 9/i)&&p()});